<% provide(:title, "Edit Team") %>

<div class="container edit">
  <div class="row">
    <div class="col s12">
      <h2>Edit Team</h2>
    </div>
  </div>
  <div class="row team">
    <%= form_with(model: @team) do |f| %>
      <div class="col s11 input-field name">
        <%= f.label :name %>
        <%= f.text_field :name, class: "validate #{form_validate(@team, :name)} form-control" %>
        <% if message = form_error(@team, :name) %>
          <span class="helper-text" data-error="<%= message %>"></span>
        <% end %>
      </div>
      <div class="col s1 button">
        <%= button_tag 'SUBMIT', class: 'btn waves-effect waves-light', type: 'button', onclick: 'submit();' %>
      </div>
    <% end %>
  </div>
  <div class="row">
    <div class="col s12">
      <h2>Users</h2>
    </div>
  </div>
  <%= form_with(model: @team) do |f| %>
    <% @team.users.where.not(id: current_user.id).each_with_index do |user, i| %>
      <% if i.even? %>
      <div class="row">
      <% end %>

      <div class="col l6 s12">
        <div class="user">
          <p class="name"><%= user.name %></p>
          <p class="role">
            <%= f.select :role, UserTeam.roles.to_a, selected: UserTeam.roles[user.role(@team)] %>
          </p>
          <p class="delete">
            <%= link_to content_tag(:i, 'delete', class: 'small material-icons'), leave_team_path(@team.id, team: { users: [user.id] }), method: :post %>
          </p>
        </div>
      </div>

      <% if !i.even? || i == @team.users.size - 1 %>
      </div>
      <% end %>
    <% end %>
  <% end %>
</div>